# Windows Machine Config Bootstrapper

Bootstrapper is the entity responsible for bootstrapping a Windows node. The current scope of this component is to
perform an one shot configuration of the Windows node to ensure that it can be become a worker node. Following are the
jobs that the bootstrapper does:
- Parse the worker ignition file to get the bootstrap kubeconfig.
- Ensures that the kubelet gets the correct kubelet config.
- Run the kubelet as a windows service.

This will be remotely invoked from a Ansible script or can be run locally

## Requirements

- Must be run on Windows server 2019
- Must be run as administrator
- A worker ignition file generated by the cluster must be on disk
- The kubelet you wish to use must be on disk. Currently we support v1.14.0
- If running on AWS, the Windows instance must have the same tags as the other worker nodes in the cluster

## Usage
```
make build
```

```
wmcb run --ignition-file $IGNITION_FILE_PATH --kubelet-path $KUBELET_PATH
```

## Testing

On an existing Windows instance which is ready to join the cluster, copy the worker ignition file to C:\Windows\Temp\worker.ign, and the kubelet to C:\Windows\Temp\kubelet.exe

On the Windows instance, run:
```
make test-e2e-prepared-node
```
If the test passes:
```
oc get csr
```
Approve the most recent csr by `system:serviceaccount:openshift-machine-config-operator:node-bootstrapper`
```
oc adm certificate approve $CSR_NAME
```
Repeat the above steps for the `system:node:$NODE_NAME` csr which will appear shortly. 

You can now do `oc get nodes`, and see the Windows node has joined the cluster.
